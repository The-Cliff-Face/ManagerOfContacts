<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contacts Page</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <script src="js/scripts.js"> </script>
    <script src="js/md5.js"> </script>
    <script src="js/searchentry.js"></script>
    <script>
        let _SEARCH_TABLE = new SearchTable();
        let _PAGE_COUNTER = 1;
        const MAX_PAGE_SIZE = 10;


        document.addEventListener('DOMContentLoaded', function () {
            const emailInput = document.getElementById('addEmailInput');
            const errorEmail = document.getElementById('addEmailResult');
            const errorPhone = document.getElementById('addPhoneResult');
            const phoneField = document.getElementById('addPhoneInput');
            const tableScroll = document.querySelector(".table-scroll");
            const emailField = document.getElementById('emailField');
            const phone = document.getElementById('phoneField');
            let prevScrollPosition = 0;

            if (emailInput && errorEmail && phoneField && tableScroll) {
                emailInput.addEventListener('input', function () {
                    const input = this.value;

                    if (!validateEmail(input)) {
                        errorEmail.textContent = "Invalid Email Format";
                    } else {
                        errorEmail.textContent = "";
                    }
                })

                emailField.addEventListener('input', function () {
                    const input = this.value;

                    if (!validateEmail(input)) {
                        emailField.style.outlineColor = "2px solid red";
                    } else {
                        emailField.style.outlineColor = "2px solid green";
                    }
                })


                phoneField.addEventListener('input', function () {
                    const input = this.value;
                    if (!validatePhoneNumber(input)) {
                        errorPhone.textContent = "Invalid Phone Number";
                    } else {
                        errorPhone.textContent = "";
                    }
                })

                phone.addEventListener('input', function () {
                    const input = this.value;
                    if (!validatePhoneNumber(input)) {
                        emailField.style.outlineColor = "2px solid red";
                    } else {
                        emailField.style.outlineColor = "2px solid green";
                    }
                })
                


                tableScroll.addEventListener("scroll", function() {
                    console.log("moved");
                    const currentScrollTop = tableScroll.scrollTop;
                    if (currentScrollTop > lastScrollTop) {
                        console.log("down");
                        _PAGE_COUNTER++;
                        const field = document.getElementById("searchInput").value;
                        query(field);
                    }
                                
                });
            }
        });
        

        

    </script>
</head>

<body>
    <div class="contacts-container">
        <div class="search-bar">
            <label>
                Search:
                <input type="search" id="searchInput" placeholder="First or last name" required /><button type="submit"
                    id="searchButton" onclick="searchWrapper(false);"><i class="fa fa-search"></i></button>
            </label>
            <button onclick="searchWrapper(true);">
                Search All
            </button>
            <label id="debugResult"></label>
            
        </div>

        <table class="header">
            <tr>
                <th>First</th>
                <th>Last</th>
                <th>Phone</th>
                <th>Email</th>
                <th></th>
            </tr>
        </table>

        <div class="table-container">
            <div class="table-scroll">
                <table class="rows" id="main_table">
                    <tr>
                        <td>
                            <input type="text" id="addFirstNameInput" placeholder="First name" required />
                        </td>
                        <td>
                            <input type="text" id="addLastNameInput" placeholder="Last name" required />
                        </td>
                        <td>
                            <input type="text" id="addPhoneInput" placeholder="Phone Number" required />
                            <span id="addPhoneResult"></span>
                        </td>
                        <td>
                            <input type="text" id="addEmailInput" placeholder="Email" required />
                            <span id="addEmailResult"></span>
                        </td>
                        <td>
                            <button type="submit" id="addButton" onclick="addContact();">Add Contact</button>
                        </td>
                    </tr>
                    <tr></tr>
                    
                </table>
            </div>
        </div>
        

    </div>
    <footer>
        <button class=home-button onclick="window.location.href='index.html'">
            <img src="images/home_icon.png" alt="Homepage">
        </button>
    </footer>
</body>

</html>
